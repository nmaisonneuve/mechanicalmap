<!DOCTYPE html>
<html>
<head>
  <title>MechanicalMap</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <%= csrf_meta_tags %>
  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
  <![endif]-->

  <!-- bootstrap
  <link href="http://ckrack.github.com/fbootstrapp/bootstrap.css" rel="stylesheet">
  -->

  <link href="http://twitter.github.com/bootstrap/assets/css/bootstrap.css" rel="stylesheet">
  <!-- bootstrap
  <link href="http://twitter.github.com/bootstrap/assets/css/bootstrap-responsive.css" rel="stylesheet">
                -->
  <style type="text/css">


      #menu {
          z-index: 1;
      }


  </style>



  <%= javascript_include_tag "embeddable" %>


  <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false&libraries=drawing"></script>
  <script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-dropdown.js"></script>
  <script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-modal.js"></script>

</head>
<body>
<script src="http://localhost:3000/assets/test_annotation.js?body=1"></script>
<script type="text/javascript">
    // Global variables

    var micro_task;

    function resize_widget() {
        // calculate new size and apply it
        var max_h = $(window).height();
        var max_w = $(window).width();
        if (micro_task.map != null) {
            $("#map").height(max_h - 100);
            google.maps.event.trigger(micro_task.map, "resize");
        }
        $("#about_info").width(max_w-50);
        var w=$("#about_info").width();
        var h=$("#about_info").height();
        $("#about_info").offset({ top: max_h/2, left: max_w/2 });

    }
    $(function() {

        micro_task = new MicroTask({
            scheduler_url:"<%= workflow_app_url(@app) %>",
            ft_table:"<%= @app.input_ft %>",
            user:{id:<%= current_or_guest_user.id %>, name:"<%= current_or_guest_user.username %>"}
        });

        micro_task.init_ui();

        //dynamically resize the map


        var menuDiv = $("#menu").get();
        console.log(menuDiv);

        //micro_task.map.controls[google.maps.ControlPosition.BOTTOM_CENTER].push(menuDiv);
        micro_task.start();

        $("#about_button").click(function(event) {
            event.preventDefault();
            $("#about_info").modal({backdrop:false});
        });
        $("#about_info").modal({backdrop:false});

        resize_widget();
        //resize the map container
        $(window).resize(function() {
            resize_widget();
        });
        // bind resize map function to the resize event for the window

    });
</script>
<div id="map" style="height: 300px"></div>
<div id="menu" style="margin: 0;padding: 0;clear: both">
  <div class="navbar" style="margin: 0;padding: 0">
    <div class="navbar-inner">
      <div class="container">
        <ul class="nav">
          <li class="">
            <form accept-charset="UTF-8" action="" id="form_task" class="edit_task navbar-form pull-left" data-remote="true" data-type="json" id="submit_task" method="put">
              <input id="task_answer" name="task_answer" type="hidden"/>
              <input class="btn btn-primary" data-disable-with="Saving..." name="commit" type="submit" value="Submit"/>
            </form>
          </li>
          <li class=""><a id='skip_task' href="#">Next area</a></li>
          <li class="divider-vertical"></li>
          <li class="navbar-search">
           <!-- <div style="font-size: smaller;"><b><span id="task_done"></span></b> / <span id="task_completed"></span>
              tasks
            </div> -->
            <div class="progress navbar-search" style="width:50px;height: 10px">
              <div class="bar" id="progress_bar" style="width: 10%;color:black;font-size: smaller;padding: 0;margin: 0">20/300</div>
            </div>
          </li>
          <li class="divider-vertical"></li>
          <li class="">
            <a href="#" id="about_button">Instructions</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class="modal hide" id="about_info">
  <div class="modal-body">
  <h4>Annotating buildings</h4>
  <br/>

  <p>Your mission is to click on all the buildings/areas that look <b>salient or atypic</b> in the
  delimited aera.
  <a href="/apps/7">More information and data access.</a></p>

  <div style="text-align: center">
  <a href="#" class="btn btn-primary" data-dismiss="modal">Start</a>
  </div>
  <hr/>
  <div style="font-size: smaller">This is a micro-tasking demo project generated by the 'mechanical map' framework.
  Create or remix micro-task templates to build on the fly your own crowdmapping project.
  </div>
  </div>
  </div>

  <!-- javascript
 ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
</body>
</html>