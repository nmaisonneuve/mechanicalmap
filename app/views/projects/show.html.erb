<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<style type="text/css">
    #map {
        width: 100%;
        height: 500px;
    }
</style>

<script type="text/javascript">
    // Global variables
    var map;
    var G = google.maps;

    function create_area(lat_sw, lng_sw, lat_ne, lng_ne, color, url) {


        var bounds = new google.maps.LatLngBounds(
                new G.LatLng(lat_sw, lng_sw),
                new G.LatLng(lat_ne, lng_ne));

        var rectangle = new google.maps.Rectangle({
            map: map,
            bounds: bounds,
            fillColor:color,
            fillOpacity:0.7,
            strokeWeight:1,
            strokeColor:"#000000",
            url:url
        });

        google.maps.event.addListener(rectangle, 'click', function() {
            //infowindow.open(map,rectangle);
            window.location.href = rectangle.url;
        });
    }

    /**
     * Called on the initial page load.
     */
    function init() {

        map = new google.maps.Map(document.getElementById('map'), {
            'zoom': 3,
            'center': new google.maps.LatLng(70, 0),
            'mapTypeId': google.maps.MapTypeId.SATELLITE
        });


        var bounds = new google.maps.LatLngBounds(
                new G.LatLng(<%= @project.lat_sw %>, <%= @project.lng_sw %>),
                new G.LatLng(<%= @project.lat_ne %>, <%= @project.lng_ne %>));

        map.fitBounds(bounds);

    <% @project.areas.each { |area|
        completed,size=area.completion
        completion=completed.to_f/size.to_f
        color=Color::HSL.new(completion*120,50,50).html
    %>

        create_area(<%= area.lat_sw %>, <%= area.lng_sw %>, <%= area.lat_ne %>, <%= area.lng_ne %>, "<%= color %>", "<%= gettask_project_area_path(area.project, area) %>");
    <%} %>


    }
    $(function() {
        init();
    });
    // Register an event listener to fire when the page finishes loading.
</script>

<div class="container">
  <div class="row">
    <div class="span3">
      <p id="notice"><%= notice %></p>

      <h2><%= @project.name %></h2>

      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore
      magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
      consequat. Duis aute irure dolor in.</p>


      <% completed,size=@project.completion
      %>

      <div class="progress progress-info
     progress-striped">
        <div class="bar"
             style="width: <%= completed.to_f/size.to_f*100 %>%;"></div>

      </div>
      <p>
        <button class="btn btn-primary btn-large" onclick="window.location.href='<%= start_project_path(@project) %>'">Start</button>
      </p>
    </div>

    <div class="span9">
      <div id="map"></div>
    </div>

  </div>
</div>